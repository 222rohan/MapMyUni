<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>IIITDM College Portal</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="college-logo">
                <img src="/api/placeholder/40/40" alt="IIITDM Logo" />
                <div class="college-name">IIITDM Portal</div>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="active">Home</a></li>
            <li><a href="#">Community Forum</a></li>
            <li><a href="#">Campus Map</a></li>
            <li><a href="#">Chatbot Assistant</a></li>
            <li><a href="#">Log Out</a></li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Navigation -->
        <div class="top-nav">
            <div></div>
            <div class="user-info">
                <div class="user-avatar">S</div>
                <div class="user-name">Student</div>
            </div>
        </div>

        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-heading">Welcome to IIITDM College Portal</h1>
            <p class="welcome-subheading">Access campus resources, connect with community, and get assistance all in one place.</p>
        </div>

        <!-- Campus Map Section -->
        <div class="campus-map-section">
            <div class="campus-map-header">
                <div class="campus-map-title">IIITDM Campus Map</div>
                <a href="#" class="view-full-map">View Full Map ‚Üí</a>
            </div>

            <div>
                <div class="campus-map-title">Popular Spots</div>

                <div class="quick-links">
                    <a href="#" class="quick-link" onclick="gotoMarker('Admin Building')">üè¢ Admin</a>
                    <a href="#" class="quick-link" onclick="gotoMarker('Academic Block')">üè´ Academic Block</a>
                    <a href="#" class="quick-link" onclick="gotoMarker('Jasmine Annex')">üè° Hostels</a>
                    <a href="#" class="quick-link" onclick="gotoMarker('Cafeteria')">üçΩÔ∏è Cafeteria</a>
                    <a href="#" class="quick-link" onclick="gotoMarker('Library')">üìö Library</a>
                </div>
            </div>

            <div class="campus-map-container">
                <div id="leaflet-map" style="width: 100%; height: 100%;"></div>
                <div class="map-overlay">IIITDM Kancheepuram Campus</div>
            </div>  
        </div>

        <!-- Announcements Section -->
        <div class="announcements">
            <h2>Latest Announcements</h2>
            <div class="announcement-item">
                <div class="announcement-date">May 4, 2025</div>
                <div class="announcement-title">Summer Internship Fair - May 15th</div>
                <div class="announcement-desc">Join us at the Main Auditorium for the annual Summer Internship Fair. Companies from all over the country will be present.</div>
            </div>
            <div class="announcement-item">
                <div class="announcement-date">May 3, 2025</div>
                <div class="announcement-title">Updated Exam Schedule Released</div>
                <div class="announcement-desc">The final examination schedule for this semester has been released. Please check your student dashboard.</div>
            </div>
            <div class="announcement-item">
                <div class="announcement-date">May 1, 2025</div>
                <div class="announcement-title">Library Hours Extended</div>
                <div class="announcement-desc">Library hours have been extended until midnight during the exam period starting next week.</div>
            </div>
        </div>
    </div>

    <!-- Login Overlay -->
    <div class="login-overlay" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <img src="/api/placeholder/80/80" alt="IIITDM Logo" />
                <h2>Login to IIITDM Portal</h2>
            </div>
            <form class="login-form">
                <div class="form-group">
                    <label for="username">Username or Email</label>
                    <input type="text" id="username" placeholder="Enter your username or email" />
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" />
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
            <div class="register-link">
                New to IIITDM Portal? <a href="#">Create Account</a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let currentModal = null;

        const map = L.map('leaflet-map').setView([12.8399, 80.1365], 17);
        let lastHighlighted = null;

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 20,
            attribution: '¬© OpenStreetMap'
        }).addTo(map);

        function showModal(title, content, latlng = null, moreLink = null, image = null) {
            if (currentModal) {
                currentModal.remove();
                currentModal = null;
            }

            const modal = document.createElement('div');
            modal.className = 'map-modal';

            modal.innerHTML = `
                <div class="map-modal-content">
                    <span class="modal-close" onclick="this.closest('.map-modal').remove(); currentModal = null;">‚úï</span>
                    <h3>${title}</h3>
                    ${image ? `<img src="${image}" alt="${title}" class="modal-image" />` : ''}
                    <p>${content}</p>
                    ${moreLink ? `
                        <div class="modal-more">
                            <a href="${moreLink}" target="_blank" class="read-more-button">Read More</a>
                        </div>
                    ` : ''}
                </div>
            `;

            document.body.appendChild(modal);

            if (latlng) {
                const point = map.latLngToContainerPoint(latlng);
                modal.style.position = 'absolute';
                modal.style.left = `${point.x + 20}px`;
                modal.style.top = `${point.y - 100}px`;
            }

            currentModal = modal;
        }



        const markerMap = {};

        const points = [
            {
                name: 'Admin Building',
                lat: 12.83957038303225,
                lng: 80.13747977324925,
                content: 'Admin and Classrooms',
                image: '/images/admin.jpg',
                moreLink: '/locations/admin'
            },
            {
                name: 'Jasmine Annex',
                lat: 12.836874401872773,
                lng: 80.1353294935948,
                content: 'First year boys hostel',
                image: '/images/jasmine.jpg',
                moreLink: '/locations/hostel'
            },
            {
                name: 'Library',
                lat: 12.8390733564217,
                lng: 80.13820326190206,
                content: 'Central Library with digital access',
                image: '/images/library.jpg',
                moreLink: '/locations/library'
            },
            {
                name: 'Academic Block',
                lat: 12.838766081513057,
                lng: 80.13702031474783,
                content: 'All classrooms of departments',
                image: '/images/academic.jpg',
                moreLink: '/locations/academic'
            },
            {
                name: 'Cafeteria',
                lat: 12.837853926836036,
                lng: 80.13847339312308,
                content: 'Snacks and drinks',
                image: '/images/cafeteria.jpg',
                moreLink: '/locations/cafeteria'
            },
            {
                name: 'Sports Complex',
                lat: 12.836449905878164,
                lng: 80.13781335604857,
                content: 'Badminton, TT, Carrom',
                image: '/images/sports.jpg',
                moreLink: '/locations/sports'
            },
        ];



        const defaultIcon = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41]
        });

        const highlightIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41]
        });

        points.forEach(p => {
            const marker = L.marker([p.lat, p.lng], { icon: defaultIcon })
                .addTo(map)
                .on('click', () => {
                    highlightMarker(marker, p.name);
                    showModal(p.name, p.content, [p.lat, p.lng], p.moreLink, p.image);
                });

            markerMap[p.name] = marker;
        });

        function highlightMarker(marker, name) {
            if (lastHighlighted && lastHighlighted !== marker) {
                lastHighlighted.setIcon(defaultIcon);
            }
            marker.setIcon(highlightIcon);
            lastHighlighted = marker;
        }

        function gotoMarker(name) {
            const marker = markerMap[name];
            const data = points.find(p => p.name === name);

            if (marker && data) {
                map.flyTo([data.lat, data.lng], 18, { animate: true });

                setTimeout(() => {
                    highlightMarker(marker, name);
                    showModal(name, data.content, [data.lat, data.lng], data.moreLink, data.image);
                }, 500);

            } else {
                alert(`Marker for "${name}" not found`);
            }
        }

    </script>
</body>
</html>